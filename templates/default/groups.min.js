var xoctGroup={selected_id:0,data_url:"",container:null,lng:[delete_group="Delete Group?",no_title="Please insert title",none_available="None available"],before_load:function(){},after_load:function(){},lngFromJson:function(a){this.lng=JSON.parse(a)},init:function(c,b,d,a){if(typeof d!="undefined"){this.before_load=d}if(typeof a!="undefined"){this.after_load=a}this.data_url=c;$(b).html('<ul id="xoct_groups" class="list-group"></ul>');this.container=$("#xoct_groups");this.load();$(document).on("click",".xoct_group_delete",function(){xoctGroup.deleteGroup($(this).parent().data("group-id"))});$(document).on("click",".xoct_group",function(){xoctGroup.selectGroup($(this).data("group-id"))})},clear:function(){this.container.empty();this.selected_id=0},load:function(e,c){e=typeof(e)=="undefined"?function(){}:e;c=typeof(c)=="undefined"?false:c;if(c){var d=this.selected_id}var a=this;this.before_load();var b=this.data_url;$.ajax({url:b,type:"GET",data:{cmd:"getAll"}}).done(function(g){a.clear();for(var f in g){a.container.append('<a class="list-group-item xoct_group" data-group-id="'+g[f].id+'">'+g[f].title+'<button class="btn btn-danger xoct_group_delete pull-right"><span class="glyphicon glyphicon-remove"></span></button><Button class="btn pull-right">'+g[f].user_count+"</button></li>")}if(!g||g.length==0){a.container.html('<li class="list-group-item">'+a.lng.none_available+"</li>")}if(g&&g.length==1){a.selectGroup(g[0].id)}else{if(c){a.selectGroup(d)}}xoctGroupParticipant.clear();xoctGroupParticipant.load();a.after_load();e()})},deleteGroup:function(d,c){var b=this.data_url;var a=this;if(confirm(this.lng.delete_group)){this.before_load();$.ajax({url:b,type:"GET",data:{cmd:"delete",id:d}}).done(function(e){if(e){$('[data-group-id="'+d+'"]').remove();a.load()}a.after_load()})}},selectGroup:function(b,a){a=typeof(a)=="undefined"?false:a;if(this.selected_id==b&&!a){this.deselectAll();this.selected_id=0}else{this.selected_id=b;this.deselectAll();xoctGroupParticipant.load();xoctGroupParticipant.loadForGroupId(b);$('[data-group-id="'+b+'"]').addClass("active")}},deselectAll:function(){$(".xoct_group").each(function(){$(this).removeClass("active")});xoctGroupParticipant.clear()},create:function(c,d){if(!c){alert(this.lng.no_title);return}var a=this;var b=this.data_url;this.deselectAll();this.before_load();$.ajax({url:b+"&cmd=create",type:"POST",data:{title:c}}).done(function(e){a.load(function(){a.selectGroup(e.id,true)});a.after_load();d(e)})}};